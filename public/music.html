<!DOCTYPE html>
<html>
<head>
  <title>Music</title>
</head>
<body>
  <button onclick="location.href='home.html'">â¬… Back to Home</button>
  <h1>Music</h1>
  <input type="text" id="search" placeholder="Search music..." oninput="filterMusic()"><br><br>
  <div id="musicList"></div>
  <audio id="player" controls style="margin-top:20px; width:400px;"></audio>

  <script>
    const sessionToken = localStorage.getItem("sessionToken");
    if (!sessionToken) location.href = "index.html";

    let allMusic = [];

    async function loadMusic() {
      const res = await fetch("/api/music?sessionToken=" + sessionToken);
      allMusic = await res.json();
      renderMusic(allMusic);
    }

    function renderMusic(list) {
      const container = document.getElementById("musicList");
      container.innerHTML = "";
      list.forEach(file => {
        const btn = document.createElement("button");
        btn.textContent = file;
        btn.onclick = () => playMusic(file);
        container.appendChild(btn);
        container.appendChild(document.createElement("br"));
      });
    }

    function filterMusic() {
      const q = document.getElementById("search").value.toLowerCase();
      renderMusic(allMusic.filter(f => f.toLowerCase().includes(q)));
    }

    function playMusic(file) {
      const player = document.getElementById("player");
      player.src = "/api/musicfile?sessionToken=" + sessionToken + "&file=" + encodeURIComponent(file);
      player.play();
    }

    loadMusic();
  </script>
</body>
</html>
