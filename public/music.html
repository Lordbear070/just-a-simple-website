<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Music</title>
</head>
<body>
  <h2>Music Player</h2>
  <input id="searchBox" placeholder="Search by filename..." oninput="render()">
  <ul id="fileList"></ul>
  <audio id="player" controls></audio>

  <script>
    const token = localStorage.getItem("session");
    if (!token) window.location.href = "/index.html";
    let files = [];

    async function load() {
      const r = await fetch("/api/music", {
        headers: { "Authorization": "Bearer " + token }
      }).then(r => r.json());
      if (r.ok) { files = r.files; render(); }
    }

    function render() {
      const filter = document.getElementById("searchBox").value.toLowerCase();
      const list = document.getElementById("fileList");
      list.innerHTML = "";
      files
        .filter(f => f.toLowerCase().includes(filter))
        .forEach(f => {
          const li = document.createElement("li");
          const btn = document.createElement("button");
          btn.innerText = pathName(f);
          btn.onclick = () => {
            document.getElementById("player").src = "/musicfile?path=" + encodeURIComponent(f);
          };
          li.appendChild(btn);
          list.appendChild(li);
        });
    }

    function pathName(fullPath) {
      return fullPath.split("\\").pop().split("/").pop();
    }

    load();
  </script>
</body>
</html>
