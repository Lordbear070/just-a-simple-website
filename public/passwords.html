<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Password Manager</title>
  <style>
    input, button { margin: 5px; }
    table { border-collapse: collapse; width: 100%; }
    td, th { border: 1px solid #ccc; padding: 4px; }
  </style>
</head>
<body>
  <h2>Password Manager</h2>
  <input id="searchBox" placeholder="Search by website..." oninput="render()">

  <h3>Add New</h3>
  <input id="website" placeholder="Website">
  <input id="username" placeholder="Username">
  <input id="password" placeholder="Password">
  <input id="email" placeholder="Email">
  <input id="phone" placeholder="Phone">
  <input id="securityQ" placeholder="Security Question">
  <input id="securityA" placeholder="Security Answer">
  <input id="recovery" placeholder="Recovery Info">
  <button onclick="addEntry()">Add</button>

  <h3>Entries</h3>
  <table id="pwTable"></table>

  <script>
    const token = localStorage.getItem("session");
    if (!token) window.location.href = "/index.html";
    let entries = [];

    async function load() {
      const r = await fetch("/api/passwords", {
        headers: { "Authorization": "Bearer " + token }
      }).then(r => r.json());
      if (r.ok) { entries = r.entries; render(); }
    }

    async function addEntry() {
      const entry = {
        website: document.getElementById("website").value,
        username: document.getElementById("username").value,
        password: document.getElementById("password").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        securityQ: document.getElementById("securityQ").value,
        securityA: document.getElementById("securityA").value,
        recovery: document.getElementById("recovery").value
      };
      const r = await fetch("/api/passwords", {
        method: "POST",
        headers: { 
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token 
        },
        body: JSON.stringify({ entry })
      }).then(r => r.json());
      if (r.ok) {
        entries.push(entry);
        render();
      }
    }

    function render() {
      const filter = document.getElementById("searchBox").value.toLowerCase();
      const table = document.getElementById("pwTable");
      table.innerHTML = "<tr><th>Website</th><th>Username</th><th>Password</th><th>Email</th><th>Phone</th></tr>";
      entries
        .filter(e => e.website.toLowerCase().includes(filter))
        .forEach(e => {
          table.innerHTML += `<tr>
            <td>${e.website}</td>
            <td>${e.username}</td>
            <td>${e.password}</td>
            <td>${e.email}</td>
            <td>${e.phone}</td>
          </tr>`;
        });
    }

    load();
  </script>
</body>
</html>
