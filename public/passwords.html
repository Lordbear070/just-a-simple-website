<!DOCTYPE html>
<html>
<head>
  <title>Password Manager</title>
</head>
<body>
  <button onclick="location.href='home.html'">â¬… Back to Home</button>
  <h1>Password Manager</h1>

  <input type="text" id="search" placeholder="Search website..." oninput="filterPasswords()"><br><br>

  <form id="pwForm">
    <input type="text" id="website" placeholder="Website"><br>
    <input type="text" id="username" placeholder="Username"><br>
    <input type="text" id="email" placeholder="Email"><br>
    <input type="text" id="phone" placeholder="Phone"><br>
    <input type="text" id="password" placeholder="Password"><br>
    <input type="text" id="securityQ" placeholder="Security Question"><br>
    <input type="text" id="securityA" placeholder="Security Answer"><br>
    <input type="text" id="recovery" placeholder="Recovery Info"><br>
    <button type="button" onclick="addPassword()">Add</button>
  </form>

  <h2>Saved Passwords</h2>
  <div id="pwList"></div>

  <script>
    const sessionToken = localStorage.getItem("sessionToken");
    if (!sessionToken) location.href = "index.html";

    let allPasswords = [];

    async function loadPasswords() {
      const res = await fetch("/api/passwords?sessionToken=" + sessionToken);
      allPasswords = await res.json();
      renderPasswords(allPasswords);
    }

    function renderPasswords(list) {
      const container = document.getElementById("pwList");
      container.innerHTML = "";
      list.forEach(entry => {
        const div = document.createElement("div");
        div.innerHTML = `<b>${entry.website}</b> - ${entry.username} - ${entry.password}`;
        container.appendChild(div);
      });
    }

    function filterPasswords() {
      const q = document.getElementById("search").value.toLowerCase();
      renderPasswords(allPasswords.filter(p => p.website.toLowerCase().includes(q)));
    }

    async function addPassword() {
      const data = {
        sessionToken,
        website: document.getElementById("website").value,
        username: document.getElementById("username").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        password: document.getElementById("password").value,
        securityQ: document.getElementById("securityQ").value,
        securityA: document.getElementById("securityA").value,
        recovery: document.getElementById("recovery").value
      };

      await fetch("/api/passwords", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      // Clear form fields
      document.getElementById("pwForm").reset();

      loadPasswords();
    }

    loadPasswords();
  </script>
</body>
</html>
